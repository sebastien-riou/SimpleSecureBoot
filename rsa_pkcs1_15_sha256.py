#!/usr/bin/env python3

#Python model for RSA SIGN/VERIFY PKCS1_V1_5 with SHA256
#Following https://tools.ietf.org/html/rfc8017

from Crypto.Hash import SHA256
import sys


def bytes_length(x):
    return (x.bit_length() + 7) // 8

#M: message bytes
#emLen: n byte length
def EMSA_PKCS1_V1_5_ENCODE(M, emLen):
    digestInfo = b'\x30\x31\x30\x0d\x06\x09\x60\x86\x48\x01\x65\x03\x04\x02\x01\x05\x00\x04\x20'+ SHA256.new(M).digest()
    #print("%x"%int.from_bytes(digestInfo,byteorder='big'))
    # We need at least 11 bytes for the remaining data: 3 fixed bytes and
    # at least 8 bytes of padding).
    if emLen<len(digestInfo)+11:
        raise TypeError("Selected hash algorith has a too long digest (%d bytes)." % len(digest))
    PS = b'\xFF' * (emLen - len(digestInfo) - 3)
    out = b'\x00\x01' + PS + b'\x00' + digestInfo
    #print("%x"%int.from_bytes(out,byteorder='big'))
    return out

def RSA_SIGN_PKCS1_V1_5_SHA256(message_bytes,d,n):
    k=bytes_length(n)
    em=EMSA_PKCS1_V1_5_ENCODE(message_bytes, k)
    sig=pow(int.from_bytes(em,byteorder='big'),d,n)
    sig_bytes = sig.to_bytes(bytes_length(n),byteorder='little')
    return sig_bytes

def RSA_VERIFY_PKCS1_V1_5_SHA256(message_bytes,sig_bytes,e,n):
    k=bytes_length(n)
    em=EMSA_PKCS1_V1_5_ENCODE(message_bytes, k)
    em2_int=pow(int.from_bytes(sig_bytes,byteorder='little'),e,n)
    em2 = em2_int.to_bytes(bytes_length(n),byteorder='big')
    assert(em==em2)

if __name__ == "__main__":
    #test code
    import os
    from Crypto.Signature import pkcs1_15
    from Crypto.PublicKey import RSA
    import Crypto.Util.number
    from Crypto.Util.number import ceil_div, bytes_to_long, long_to_bytes
    from Crypto.Util.asn1 import DerSequence, DerNull, DerOctetString, DerObjectId


    def to_bytes(i,byteorder):
        return i.to_bytes(bytes_length(i), byteorder=byteorder)

    def detailed_testvector():

        #test vector from NIST (http://csrc.nist.gov/groups/STM/cavp/documents/dss/186-2rsatestvectors.zip)
        n = 0xc8a2069182394a2ab7c3f4190c15589c56a2d4bc42dca675b34cc950e24663048441e8aa593b2bc59e198b8c257e882120c62336e5cc745012c7ffb063eebe53f3c6504cba6cfe51baa3b6d1074b2f398171f4b1982f4d65caf882ea4d56f32ab57d0c44e6ad4e9cf57a4339eb6962406e350c1b15397183fbf1f0353c9fc991
        e = 0x0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010001
        d = 0x5dfcb111072d29565ba1db3ec48f57645d9d8804ed598a4d470268a89067a2c921dff24ba2e37a3ce834555000dc868ee6588b7493303528b1b3a94f0b71730cf1e86fca5aeedc3afa16f65c0189d810ddcd81049ebbd0391868c50edec958b3a2aaeff6a575897e2f20a3ab5455c1bfa55010ac51a7799b1ff8483644a3d425

        message = 0xe567a39ae4e5ef9b6801ea0561b72a5d4b5f385f0532fc9fe10a7570f869ae05c0bdedd6e0e22d4542e9ce826a188cac0731ae39c8f87f9771ef02132e64e2fb27ada8ff54b330dd93ad5e3ef82e0dda646248e35994bda10cf46e5abc98aa7443c03cddeb5ee2ab82d60100b1029631897970275f119d05daa2220a4a0defba
        expected= 0x0e7cdd121e40323ca6115d1ec6d1f9561738455f0e9e1cd858e8b566ae2da5e8ee63d8f15c3cdd88027e13406db609369c88ca99b34fa156c7ee62bc5a3923bb5a1edabd45c1a422aafcbb47e0947f35cfef87970b4b713162b21916cafb8c864a3e5b9ffc989401d4eae992312a32c5bc88abbb45f99ac885b54d6b8e61b6ec

        print("m=%x"%message)
        key=RSA.construct(rsa_components=(n,e,d), consistency_check=True)
        h = SHA256.new(to_bytes(message, byteorder='big'))
        signature_bytes = pkcs1_15.new(key).sign(h)
        signature = int.from_bytes(signature_bytes,byteorder='big')
        print("signature=%x"%signature)
        if(signature!=expected):
            print("expected =%x"%expected)
        else:
            print("match")


        #now do it low level according to https://tools.ietf.org/html/rfc8017#page-36
        #RSASSA-PKCS1-V1_5-SIGN (K, M)

        #M: message
        #emLen: n byte length
        def CRYPTO_EMSA_PKCS1_V1_5_ENCODE(M, emLen):
            msg_hash = SHA256.new(M)
            digestAlgo = DerSequence([ DerObjectId(msg_hash.oid).encode() ])
            print(digestAlgo)

            digestAlgo.append(DerNull().encode())

            digest      = DerOctetString(msg_hash.digest())
            digestInfo  = DerSequence([
                            digestAlgo.encode(),
                            digest.encode()
                        ]).encode()
            print("%x"%int.from_bytes(digestInfo,byteorder='big'))
            print("%x"%int.from_bytes(digestAlgo.encode(),byteorder='big'))
            print("%x"%int.from_bytes(digest.encode(),byteorder='big'))
            print("%x"%int.from_bytes(msg_hash.digest(),byteorder='big'))

            #b91d0b7a09f57c109926a449647283adb5dc213c0fdb0cf2b219e064cc132273 2004 00 0501020403650148866009060d30 3130
            #                                                                          501020403650148866009060d30
            #b91d0b7a09f57c109926a449647283adb5dc213c0fdb0cf2b219e064cc132273 2004
            #b91d0b7a09f57c109926a449647283adb5dc213c0fdb0cf2b219e064cc132273
            #b91d0b7a09f57c109926a449647283adb5dc213c0fdb0cf2b219e064cc1322732004000501020403650148866009060d30313000ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0100

            #3031 300d06096086480165030402010500 0420 732213cc64e019b2f20cdb0f3c21dcb5ad83726449a42699107cf5097a0b1db9
            #     300d06096086480165030402010500
            #                                    0420 732213cc64e019b2f20cdb0f3c21dcb5ad83726449a42699107cf5097a0b1db9
            #                                         732213cc64e019b2f20cdb0f3c21dcb5ad83726449a42699107cf5097a0b1db9
            #0001ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff003031300d060960864801650304020105000420732213cc64e019b2f20cdb0f3c21dcb5ad83726449a42699107cf5097a0b1db9


            # We need at least 11 bytes for the remaining data: 3 fixed bytes and
            # at least 8 bytes of padding).
            if emLen<len(digestInfo)+11:
                raise TypeError("Selected hash algorith has a too long digest (%d bytes)." % len(digest))
            PS = b'\xFF' * (emLen - len(digestInfo) - 3)
            out = b'\x00\x01' + PS + b'\x00' + digestInfo
            print("%x"%int.from_bytes(out,byteorder='big'))
            return out


        modBits = Crypto.Util.number.size(key.n)
        k = ceil_div(modBits,8) # Convert from bits to bytes
        print(k)
        em=CRYPTO_EMSA_PKCS1_V1_5_ENCODE(to_bytes(message, byteorder='big'), k)

        em_int = bytes_to_long(em)
        print("%x"%em_int)
        # Step 2b (RSASP1)
        m_int = key._decrypt(em_int)
        # Step 2c (I2OSP)
        sig_bytes = long_to_bytes(m_int, k)
        sig=int.from_bytes(sig_bytes,byteorder='big')
        #sig=pow(int.from_bytes(EM,byteorder='little'),d,n)
        print("sig=%x"%sig)
        if(sig!=expected):
            print("expected =%x"%expected)
        else:
            print("match")

        #now low level hardcoded version:
        message_bytes=to_bytes(message, byteorder='big')
        sig_bytes = RSA_SIGN_PKCS1_V1_5_SHA256(message_bytes,d,n)
        sig = int.from_bytes(sig_bytes,byteorder='little')
        print("sig=%x"%sig)
        if(sig!=expected):
            print("expected =%x"%expected)
        else:
            print("match")

        RSA_VERIFY_PKCS1_V1_5_SHA256(message_bytes,sig_bytes,e,n)
        print("verify pass")

    #detailed_testvector()
    #all test vectors available from NIST up to 2048 bits
    # CAVS 11.4
    # "SigGen PKCS#1 Ver 1.5" information
    # Mod sizes selected: 1024 1536 2048
    # SHA Algorithm selected: SHA256

    testvectors = [
        {
        'n':0xc8a2069182394a2ab7c3f4190c15589c56a2d4bc42dca675b34cc950e24663048441e8aa593b2bc59e198b8c257e882120c62336e5cc745012c7ffb063eebe53f3c6504cba6cfe51baa3b6d1074b2f398171f4b1982f4d65caf882ea4d56f32ab57d0c44e6ad4e9cf57a4339eb6962406e350c1b15397183fbf1f0353c9fc991,
        'e':0x0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010001,
        'd':0x5dfcb111072d29565ba1db3ec48f57645d9d8804ed598a4d470268a89067a2c921dff24ba2e37a3ce834555000dc868ee6588b7493303528b1b3a94f0b71730cf1e86fca5aeedc3afa16f65c0189d810ddcd81049ebbd0391868c50edec958b3a2aaeff6a575897e2f20a3ab5455c1bfa55010ac51a7799b1ff8483644a3d425,
        'tests':[
            {
            'message':0xe567a39ae4e5ef9b6801ea0561b72a5d4b5f385f0532fc9fe10a7570f869ae05c0bdedd6e0e22d4542e9ce826a188cac0731ae39c8f87f9771ef02132e64e2fb27ada8ff54b330dd93ad5e3ef82e0dda646248e35994bda10cf46e5abc98aa7443c03cddeb5ee2ab82d60100b1029631897970275f119d05daa2220a4a0defba,
            'expected':0x0e7cdd121e40323ca6115d1ec6d1f9561738455f0e9e1cd858e8b566ae2da5e8ee63d8f15c3cdd88027e13406db609369c88ca99b34fa156c7ee62bc5a3923bb5a1edabd45c1a422aafcbb47e0947f35cfef87970b4b713162b21916cafb8c864a3e5b9ffc989401d4eae992312a32c5bc88abbb45f99ac885b54d6b8e61b6ec,
            },
            {
            'message':0xdb9eae66bcacb01ba8029fbac5fef13156aa1a768c3dff259ee5ae6b1cc34c2280374e3d065fed67bddad3e7ded21bc75d397835bf52b4292b745d48c30bbb0935df04168c99d3f54d83d7e7bf8fc8108a9ba0d983f30793c7170f5d07bf2147221d38b7f9624c0c7f8312820f3de2550357f82a8227e0aa99572c708de96825,
            'expected':0x5a616faeb00680f5c4ef633205040b497b5e5e226e4a8f493b1ec2a26fe7a0971fed4e1b8f188eba8161266fe558eab539f903c0cd8ed18d21af77e30cb264c6214a175588ed542b5fbdaae99e924094e8c8a22366441d866126433aa45cd37773b9dc3dc179ec8cf51efb8bbdedcd229cd2dc2334f5bf2b0b00374350e6147d,
            },
            {
            'message':0x2e22656e48856240b0f655d2022d69ac731a1c63151ba36e57728a35cbf69c6b2d08029ea0c9af0c3a8bfbb9c3858dbebaca7fe4997cbd715b3cae423ae6171abd7b3c3af25f4832f8c5eef6c1675134167a21e5dce1072395a1443a2a959501e763596bc7aef559f28d78b2843c7bb690124c8f65b34b290f879344216bddc8,
            'expected':0xc24dd39dc4306bb0b06d548091714820f14a3938437ee76d5302f7006213d388041b79db6125c337ce41d2086f2536026f0fffd20aa9dacffe4e601dfe51310729ad050c4f396b0223492a63d9a011f70cebf8850f61f0ca2ea94800f51e35bbb077e99beaf12fc2caf1744700eb1e027bbb450308e167437272433ee7a765fb,
            },
            {
            'message':0xcf785002292f1ef9645f2f2cdc0455b29d0ba1efc91fde0a3ac05fa16995fbbc8e03550009fe6126011f23ab4bf7bac88da49ea4a3a126c941e34dd4da21b571c173ec878f1eefb0c4aeececb1464c969535f19706c9bcd9926853ffa7dc2153b0ef9eff8138d081f5341259d5991404fce6232eb93faa247578f98896704648,
            'expected':0xb34c8e11cbfd2927bcbf442a6afbbd6ea5c20f5e47cf56c57dca93e10bdabb20b958997b216b92d09fb92cfc3445346cc9e63721b73db06dc9e36727b8daa5f16fa4959c977f6eefcd2fc9790c5e01f31f8190360d380f4332526472e32b25e54781bdde98016bc25ef8697d5d73a6b7bba06fd3d8b9ebe3c657b86f07028ced,
            },
            {
            'message':0x302219bc6c07e628f352a45091719bb0e655875fb97691388f187e377ccd27253a3c29787820dd7574948b97cc8dda3492a88b5e9e26670828347669967072a692aa7bab60e70c596eac2ee72d79ec82209306373306ea134debdf8928e7841361f4791ccb645c1e0923f7085c3cb7e2b99e60b31f2100a327c4225ddd3843b7,
            'expected':0x68edf786f166f9aa932816d70b7786e1d88128da0ce1212bba5b56fc8f8dc21d54b5bd44401af2119c4a4f03cdbf75615cf08f3764fba03aed856ecd01caa15ffd6a3604a612c81218f3c395b931fd5fe78031b674369e49b185de6c00b6effdd8d10aab7bfc6671900c58c6882850de5a37b87c15caab18b8cd6bf8e5132020,
            },
            {
            'message':0x1fd68998e4c34ded43d2e51b1680a6b3fdfdd576033b6a0d7f4413fb39d27ccfce19ce9e56e876b043f0277a8c6322cc0cc2b54c25f00123a88a01f6f97bc8186eca0afef9b7def30707c20ca79ce05fef4890709be31decf89bcc9a018c1a8ec79146a016590f1c55bdbfbbae5068d26f386ecab03d45d037207ccd982efb99,
            'expected':0x0687bca5c51bbddddb68d21a912b7d3f89a54517b7f3c6ea5da386b5fb6be8c7a172d6528b2dfe9cdbcb3f4cca1099a1003a69176eb3292a1571b8451693e1554c6ec5e9d336771378718a9e822f02f783b9cee3c0f8ff2654539c495478ba68cca6a6683303a104230e4dde1c35e194eba1ea50e7fe690cb19d2b1118a87be8,
            },
            {
            'message':0x90d0d6a410f8aa868b64128c039cc698a3b2e36700744969a0e741d0b9f164e73a56b8a60fe61b83a1f4e58a9d09c9b0f7dafc652e789968d1c745df42310fa7ba9b99e98d987deeb0ddea3478f68ec1a437b9b79ef4bf29fef59e2d5024e0321789c3941278986ebd0969b01bc9de71b3af6186d85281532e5894e16a32a131,
            'expected':0x13049092c675809b386459eccbe1c540a1a8e9cb674da9d11349f2c50e559387f019154216370752c8ae0a7c4b6e031f414f7a32a8ebf6f4f87d4692caa44e535565e0c0deb9471411126f6dfed6dd860edd1e97468b7e144f8ea6e0b5063d3ebea598b47ef9d6292ab0c05f5621d20bcb389d550bee84d190d79c7d8820a97d,
            },
            {
            'message':0x644a3de6100dd8a36c841446b9376b345d478a329450a66f629313c5cc55133c4782ecd071963d74ffbd9156f63935651f054711b4b8105160ab94eb675e66f02018c185acced5e9e2465fb4897d7c5dca45bfffe432815d22b778230b8d8c6fd854e58f2b7d490dfd67a5e8d8c8e925474f19868c88a19a90ffeaf620a82ac1,
            'expected':0x43e64b245e65eada15e66dbcf12332ae80637917e65a68f9f9de45be6ce1854a582634c139892d5aa29187801c7ca47af5ded85e5b0a32e825d706f6eb0b2dffa2f80f69fecaf87aad0919765cc2cb2042e124eda7cd157bedd321cc12100f8ceb3b90b68da13e5aa65c2c3ec184c6abbbf86dcbffdf1ce36f1b5563e8b56044,
            },
            {
            'message':0x29e9cb3482e9eda5e6d714a2dc730d91bdfb2d42b14fe82ed953a0fcce95bb4a4b30f8a926f003e985b647984e1e03c5df60a009007442c9157a9db599580a94c7a5d9449ac6e9fcf85677d52acc348990579a7a930d7ff6da45ebb9c14127b30711160cc6b3c866a97f4d6259c3c76538aac39c5262ca3d917d321030983a2f,
            'expected':0x57b17157b4eaaf0a9bdcb9abe4b299a728e6df5f8e03d688037d5e1ed5c9a66c20ac739e1c3516a4cf78155f52ed7d054b5c5fed534b80dd3fc92fc0920eae695f2fb9626cada584d572927a00d612aa690b7f6051dd581cce4748eab9b4d886addaa32c4ed7d7221862354556eb68197b05bebda90c3e01e00e27c5ef547c83,
            },
            {
            'message':0x467e8ea634f7995dc46c11b8ab0b7508894681e81c3502c3b335e897e6d69df885f49557ce232784e3519b727ba6843bd7af5063f8bc1d610f86ce5b35155e325ce175be8538395b34df67a421fca27e31330b59a41011b290a58bdc8e740401b38f5564c2fd7ae89f609ed607d578db7f1cda508af987be1fd946a25ab9346d,
            'expected':0x2b1ffb370d518a82646d86828db1fc7e8bfe73ee878da120fa92737c9174688995f2255b29e83b28c244cc563c9b33efd3f9f9e1638e2c16e24f2eae19435696b2f4d1cf73064fc1cfccb2278c01f0979e7de7463bf8417bd6986fbf1d34d382a978ce799582442afcc92b4fe743216b6f151f6a561d979cf683cab6af2ff4c5,
            },
            ]
        },
        {
            'n':0xa2fbfe82fccf847724640571bd393ca2dbe4e9a3ad85cbdad9151faf27b7127d37147cb7fdd3508d68b9a8b5b914cacc863b3e180665bad32c0c1ec8f9d87740fa5891de8f54085eb0424d2589f53adb20ac92eec98d9ce5378e9875ee7890f99b3828662471b24ba2caad362487030169dd127c8e6e7bf3c8f01f7ff5e09d3e91189ac6e37355dda7526dd5b63c6b32cc9f5b86251fdc9db8ba9e676f848a44e59c095550d4f4480295ae327ac7fb877a2835a216cc06c3786682d31b6dff19,
            'e':0x000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010001,
            'd':0x068b7f86339042c5c50a963461d0a35877e39aa545c1d674989c924be698a1afb10f4bcdd8adcc718d47cd5854d11aaeb9623625615662f8f96f182a626c18a7dd95c26fd14a22d6e895950301a5fd21d10f550c2d40585155188f13474b04a94cee8df7e6b889c4e9b68145886eba209577ff4ad3072c72219b72b0803b308fb2e4d9a8bbd370088c4de857827136612f6e7731d56900318c433eda485a4798ef7be50a530f1f3f173fc251ee7192c3bceb598c109872fca098b9f9d5cc0001,
            'tests':[
            {
            'message':0x37d7fee3d31934912167e1ffb35b4b2f159e84bd02513d65d8abdbc44ae3cd6355501cf175cf43d0186542d45325ee47d4548b3018cc9cd4de9efa7edbfb247caf55d66a18c1ddb365a029542e7e24e3433a42d0e267d9ec2df33427da06e39e2d2d54d523b8a840f161bf09ac2e950d4a98d228c9ec9cb2aef2b049b1cdb1d1,
            'expected':0x092a257b50a4e4c8c7914e0d19c0088778e5cb4a815fd3a4eb59ccf3e71233934f9bcba2e03465f2c12d2100e722c703acc6bdb8626cac09f964f9f4ba527d9c49a6d6a2136873666bdcba0a297a3c38fe48731fce5a7276015c4d750de6fc550718544767c86df16b048cbd8ab8a878b6bab25ad642dd57102f323471e2fecb84f40be00c79f75db6bf01ab070fb2874cf11a3d4e81e15f878b0797b534743e9666c93f782f0a11539c0154f406c710f1f5e24b490d7f468691ca28730a4802,
            },
            {
            'message':0x15750e411ed6b1487e9bfae96aaf758f6c059ce1668af84fd45889eb512c687b5d1aabcc5d7f8949e338bfcb301131b3f780d5376494cdf95d28d3de085cda1d8d46f2961de46d66335540b81949acddafb71da068ce52d3952dbe2ee6562e5a2d60ad4866eda4c7f55c46562e402b361a103bc47820ce0603cf1284f302ac59,
            'expected':0x45f6202a029a0b5751ca6aa81f8712da94646b05a44901f8f972834fbd8745e0716888e26fa9319eaf30951387bf9370a3e005c970dae2958e8c3aef1e4bba802af877140b39c467595147215f44a5726ffe4be17004d61d05f39505023a2942cd8c9bc0a2a8ef8b8abcc4bf02c694b5b2d90cc5f27aeff2f3078eb7dad4d0c292d43801cdaeb8c59c5e97a6beb5fe03e320f9ffd5cddea1448d3d308b6d8bde90fefc1083c50f78e8f2e27c7c2a1b54d5dfd89d9a76a40b6dbe118d57336a31,
            },
            {
            'message':0x369d20e16d4a6574d4f9ee511106bc494268f7b5eed982b73b38d3c2622b025c61081f22f0f6c90db54ffcf5bb492b5321d68f4b0fc8beeaee397facd92add414e6a7a902aba26fdd42eb0e7b8d6fc75f79e56935c73063793a725e99597af82678bd93404dda4ca985eb231eef558382c89f694be218327904a6c8280ba9fa8,
            'expected':0x2352b15d1c536146660f89d7a6b54adc9d68c0d9444fa527321e19f5444f4118c32b8345339bb6ba35c852dd575db7e3695fbfefd42aaca046b6ce657137c9ed4d010a15faef7f60bd4e6befcabb4139964af96f6be6a9911dce31cac26b9ec7eb21be01b9068c8b03483b47874a6a3c15f08534ada689a9b4bb641b9dd8a12592b8b10c7f437c6ce714c3097ee4049ce19203dcf5e0eef76c0f933bed0e624f8c4a2d357d2379c4e3a1d382def0dfbec85d48c6314bbd6918a583c4c0dc37eb,
            },
            {
            'message':0x1f75ef4371178356081e4bab44fc3c706a706f6eecb580e0ebf93485fa105ef4256a03303242bc7c26195c700b63d34df180528e33edb0bffbbc0d920841b530af0f46cd2023167feb5ecf50c3395c9281b409726c8fe5d0b7bd6b4e4b1662a7c74c0243c520580860d5ec72f3e5a0e622f4db431f02e7bb26e498e14af52f02,
            'expected':0x643a46e16763ecbcd7287b66a93c897d2e84d3e4eda24f2e518f04814d3d9d5aac3365d9541f5edcd165049b22a9066fdc9525ae6dd5e542830253f00864ce8b40c9389aa2857453f36996957e0ba5ec2618d47a6f514e2e0451684289baa89704a33f35f242c6f94ed286d0ac7301c35f4361e7b6df1232e787d081dab1ad98bbbdcfacde5996138d52ad8c98843d3ad2458c1cb0143de60585e666c8a82843c750e8d28c41b001ae73c842527e60d54f1dc20320f90a663c701f2bab8696e9,
            },
            {
            'message':0x7f07b5c76d5b9e9d77d3b03b69de2f21cea9228b06e5075098cac60ac95ce4776dedf91ffde36437eabb3dc6314e8b063053b70db72641ac63c8b2982726d2c72c9e1a1ddbbf6c48385002e97194a5f4b6cd1f594cfff2e4ddf64a61138a31056522020930772098099be7eb5239e3b30b1e40b7ebf882beaf5e77afb31169f7,
            'expected':0x8814eb974e33027b3ed47ca9cbe7135e4aab75547be3b661bec48dd15e13bf3797681e9a96c83a409d46796decfa3155255af5d534d660596066f87611408c93c90a403e048f0ffc44d4b079a96000684c998fdc82f662e82df711b057ec7de01b5f42f348c0fb445d3fa8d8373d0ad9a5371804d999e77b6a6977fba65a6eca76c4a84af4ff3805020d6ed3dc5f75e1ae88972dd70c1c00956f39cd8b22e5fc2a613aa364ce45cdfcdf02cee909ab0c54ea0eb1997a8bc97d399fa36243a162,
            },
            {
            'message':0x57678a5baa2b4a39f8c33f62a3977fa9f9516116b64a27f4ca41e1265d538eba112783c1876a115d247b621b1567a483901769ee5dc84e9896bcdbf6ab2fab4aa88dcd74bbe2690bf192a7ac404acc92ca36a76760752b5a45ca5d7235947122a6002f1d4e7d9c6be570d7bd2c2941fe2e16e02ac637066361d22d420568266b,
            'expected':0x5658d6bace6f80ae25ff1cddd8643bfe197b7699edb35a2035fe325d01e97cffa894a2e93c22b77de799531f0812b4931224a7a5fbde302b11397fd8804ff48471beb3c50ff90abf95d80c3b138d5ab3a79108fe5ff7c89d1abe4bb94cd4875feaf4384f5c3c32ff3118b20048d2473368bcfa5b3075606dca2e54ff6e27f00457d6bc5b8f7c6c86675d47fa032e7c395eda977b841cf2e72067d1285113c5081f8d6b14659ee1bf49c78214efdfd866ed4d2c0f72ca661a59844a9f83c3966f,
            },
            {
            'message':0x15b1e07d9a1bfe53c7becfed15c721ef602b641d33dd0c29464437c845ec900bd37c73edcfe85229d6e7574e09a84a1410c0b6f15f6847e8b7e577a2f04769bff756156e13caa63b6cba2029cd574601a9dabbe95cbb6738b4241c89b0a57a0f87291028ec29c334911f74a7ea3edd5d3360bc2eb44034c344e970a70c6e89a1,
            'expected':0x4a5b9af9c12d4041775070e6f2b1d8b5a3c7b4966ece2cdf6031e9af8a8607ad5d3a7903263c9467a3e099d2d937f8111164ee8ad3b0b8d4b7862b2678df2bb765dd03375591d90265d136edab69518b33bbed389c7746869e598f82965851d16b3d8b7c4f83d073c58ef3360112e5a775dfd0a3433ffe72df030145969acaf07ffb9874304c1ff20e4df02b9436cc03dbb485955eeb7b6a02665f61edcc22fd908a0ea8fa61b9ae52a346a691828c9ccbe8d12f389f6aff37bbd9cd0ffb8c1b,
            },
            {
            'message':0x50b0b8dab5921fbb12b835222008164e6de95b04ff58e03d3a39cb1c04eac922261e9ba5f5e9d27e3317d60330c22d353424fa3a21a9c40d55487974ce14b332910e397e4c3ec9b53a02154c47a50b08753359717e8c3184bbb849a8447a27e359289b4e00b98dc6f020f8e5aed93730f6c180925c2aae0a332f43a0ae45ad9d,
            'expected':0x2cd9c7f555f84e77aaa544ab5fce57a019519e094d1c762832fbf940259833f126531f4758278d3b24cb438816cc9c0c1b803d90533914c20e7329d92c0cbbb87bd4c16d1f1f0b9abee539b7aff350c1a4d65d29e80f7765ba09f20d8fabdd1f7ad7feaf4191157dc7617b17b0325b1d9fd51d2b7e0be5d0c00b1578710794907689cad46bfa7be95bc7ad92de5eadd5d9716898cdc309c26e8ec7967b7137de73a5742c1a4b55ada7700d470ecf8727b27d3be9d6c06ef44f6a19671b53d0fb,
            },
            {
            'message':0x5511c2b0d2dfd25992ad78735f326382ff2b2a5359f48e32da55005e179e63bab4f612c584f025ccf15ff05f9f6ccd014ce51c23fbd8875451618bb23fc033a4e1ae27cba6f2e635b22f50d48000672fcc465658b0c1b31e0dde01832cd07971a5e20aa8800c9efb9bc49fbc4b16b97546f7e2d8c1d798f9d5756abb27f7ba88,
            'expected':0x117b987b4c79fe569bb0031cb63ec610b9fc4da8ae05b20ca2fd0608c6c8967baf7fd34fc45ef9e4532013a0a3502e608544a63a5e218109e58568ccc2bedce3b48c0fdf4748b0ba4b4bf569d8e9c50231bcb0caba31e32b2cf8d57edda8bf9770705fa072cfcbf0355979080d8e7291179246f1be59a4d7786e8dbc548598d8fcb3ab293c95b9c897d4fe285ce6863f1eb90e953fea9a36d6a5b359f08d35a8854925940aa06fec66176549e79dc99054be00f0bd9211782de7a3392740684d,
            },
            {
            'message':0x67567351452fd3aefce4671f63c1d5036dc1c0bffb0c3f62f4be8e8598ea047611df45954ba9b9fd06db3d672a8c184c5aa0304acb497ec957ccbfdecd896c708c36ed99506b0a4e4b63a24378019f092c112979eed11a5688afb22e5e558d81ffe3d126fa7bace9f303fe79f52652820a9c131609acfd51b0efd13df2564df3,
            'expected':0x2bc0a09493a57b56a5ec1e3b4733450e06bc64644b3a9c3af86b30866022702f1d018b4f56254e74fd997877db8a8683b2fe1571f494ace3a7648fd940b957b0b7e98383b9d42fa5b48528df653489ecbf7f92af7385da03af27475db872c6273f2cc79762b05ee0ab2aefbb682a0d415614de31370aaa2634480f5ca7ba0e503b45d44c31f56402fd58bacf34440a26bcb0f8dc187d7761e4cfcc17c78adcaf0c54a10ff6977def477befeb9a85aac64555369c11319b0c97cbfc5e4741dd0f,
            },
            ]
        },
        {
        'n':0xe0b14b99cd61cd3db9c2076668841324fa3174f33ce66ffd514394d34178d29a49493276b6777233e7d46a3e68bc7ca7e899e901d54f6dee0749c3e48ddf68685867ee2ae66df88eb563f6db137a9f6b175a112e0eda8368e88e45efe1ce14bc6016d52639627066af1872c72f60b9161c1d237eeb34b0f841b3f0896f9fe0e16b0f74352d101292cc464a7e7861bbeb86f6df6151cb265417c66c565ed8974bd8fc984d5ddfd4eb91a3d5234ce1b5467f3ade375f802ec07293f1236efa3068bc91b158551c875c5dc0a9d6fa321bf9421f08deac910e35c1c28549ee8eed8330cf70595ff70b94b49907e27698a9d911f7ac0706afcb1a4a39feb38b0a8049,
        'e':0x00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010001,
        'd':0x1dbca92e4245c2d57bfba76210cc06029b502753b7c821a32b799fbd33c98b49db10226b1eac0143c8574ef652833b96374d034ef84daa5559c693f3f028d49716b82e87a3f682f25424563bd9409dcf9d08110500f73f74076f28e75e0199b1f29fa2f70b9a31190dec54e872a740e7a1b1e38c3d11bca8267deb842cef4262237ac875725068f32563b478aca8d6a99f34cb8876b97145b2e8529ec8adea83ead4ec63e3ff2d17a2ffefb05c902ca7a92168378c89f75c928fc4f0707e43487a4f47df70cae87e24272c136d3e98cf59066d41a3d038857d073d8b4d2c27b8f0ea6bfa50d263091a4a18c63f446bc9a61e8c4a688347b2435ec8e72eddaea7,
        'tests':[
            {
            'message':0x6504921a97cd57aa8f3863dc32e1f2d0b57aff63106e59f6afc3f9726b459388bae16b3e224f6aa7f4f471f13606eda6e1f1ac2b4df9ef8de921c07c2f4c8598d7a3d6ec4b368cb85ce61a74338221118a303e821c0f277b591af6795f50c40226127a2efacce4662fd7076c109eb59b18005e7165f6294a6976436ee397774e,
            'expected':0x335ffadc0b1b8bd2b1eb670dd246e76dcccdc955a1687a15f74aa3e1596ebd43e607c640525f89dda95809cfd065f1be4e4a249477d24f400d4d4c9438a0af95b26b28b416e42aa950e2a52851b52132048f1b1ce944322fc99c1aabb49b7fae4c2f0fef674b50adee3bbb5c6c33822b608e4b9577275ca20c710af9fc41b1c01d9c0ff6f0d8324dc08e1a76e232d8feaa06c73bbf64053bea35f1c528b2722764822ef1ff06246e75a9a22a10da4ea84fc2441bea24b35506f8447fcf69093c5d21ab0305cce2c7ea9ffac357c664b491fc55f2919ec490c38accbab378c252ac2df3845acff575ec7524cd2f586cca1497c74f24b299d6d6254c8cdb1d227d,
            },
            {
            'message':0x1a53a9d6312918f3db6bd5766da981854166ddf2b613ebc8793f50230308fd4563d50ee73e47f2cd146ccd9dc4361af1532c95abe96058891ca144f971f1a22e203a0a73183c84bf43caee8a0b369ee01d0a48b46df821767a1444e8d341552ddae96522c8f216f2f1ed00e54a9053792866bdb44ac58eb81a011a9830df5e6a,
            'expected':0x7b17b13a5ce4485ca3b979be3b14d77532fcbac14e460a54515a6aa7d213ef1410cadd009ce60bfec45bf494514338913a2792bb6086a4cc21dbe852c2b57a3ff5931039973cdacbba96e2ee77fb8ec6c87c14ea10762e2aa9279ae5192ca1c87ededbedfb305fb006a51602e6bf4dc43b994f419c979b4f30719827a348948214ee71565361f668dbf81ef6e94297a3ccd68357fccca6dda237911c938d6e71787b3d4085c66c7ca2aad2db16274df23ad19211aa6380be75cf0b19257af4df5af1e62010dffd23b9742f5369e008224ee40331f2387422095f6e5afe0e125f855de220648a845cbde542ff7f99d926868819aad924b3919654483bbc6d8dd8,
            },
            {
            'message':0xddf5750aba4be69c944d71896361f210f961ee6b38f96e5481500ec76fea510ac6cd37eba6e21249059f95d55ce32e1a9f2196bb73c1a6fc9cc36c84b4a67e6223888e4d4b8e3f30038637e647cb75412d69e5521b8232e438f1dc4a202c8a5bdc6fa1ba1117155b774c80428de2718e8c8106b79904bd143e2087a01b461efd,
            'expected':0x9e32925845931c2baafbaca8df109cccd922ba72e6f4b838a76198b1f3173e9069ccf75d0c96d6e2644ade92b29043f6bdbdcfc8b0b2794b4ee16b1a8ef8eb2dd2fa3da4bacf7659e43e70d69c132bf9cb1ba8584bf3c1e0a7c8803566177742c977e447d357fb0331dd3112e7d3c0f1b5772a7cf5e1e368cb58b1a18889cff9136bd56b5cc3fe6bcfc5a9f26dd60715a807f3c7ca236c89ddb36ebafde62b35a624284121f56d81f5a4d215b7a36976eed2c78a3c44cc864c6a5c01f4ef9f54efc4beb947b96e9aeb50af6221dea96d620baaad235e9ba6a003fdd39f31388a4c3579dddc0a51e879e1286ac142601d2e5725c1ea9d44aa896a12d29047aa3e,
            },
            {
            'message':0xf866ae4a8c37ce71c0e047ecdf0b6bd07f8b11adbd92f363ca245536a7cbe8242c8ded754f1b9d95a34bc91f1fc8be3a21086b28b27fc61c0c136b4c5acf8648bedbf48a98aca54e067845a4a7ed1bc3a52231a0f2ceb5bfd1b89f49996e9460b53a0aaff052ae45f04f02a3ffe04b1312c0aa3c03e589f422fb3855ec10d813,
            'expected':0xbd4d7db1d17c3f56062a1dd4307d939ddd403cbf04b0866603541fa8de37ce80bf06d796efdead6963f603d81e376dac20454c4964c1e6fa347c8dd7684215580779be97f94c8279efd0169ea0cfdd282d3538bafe067ff5ad9e624cbb24f42f1811287fda0903afd3b516875a8ebdbc81b4a63286a35bd66156f657f110b9909e983043133cbf0d0fd1cddb4a3e1fe0962e412af91682e44262869524c92557f5d8fb385fa16e87304aaf534e90d256684600381770b77629d1a7e8f4cbc9f956a1e0d2e41bf57207c677abf6f38094ed0e6ad4810d49eb09b51ed29ad6087f72ee019a4f99a816d142c155fe91c93c38f928fb1558e3743d545ec3cf8ff4b8,
            },
            {
            'message':0xd737bd2729d1835f243983fbc152a19a2e659a5d211ff3006dd92f4ad31d45a81a65511561258a3cb50c74e1df87577d7f88ef285f8565bc01c37e387ad41362835fc1b1ce1fe169962eba087a84f6e18bba5307a4149b6cfabfd64af357bec23cad73c416c6702ef027be383b4f670f7a862ec098d57d587f569f49e6ae2f10,
            'expected':0x581e5c157c6b960933bafa5d7fee2746596db490a57761ade4aea0f76ef658d832b603e8cb9e03a853be53e02d4deaec2e7764e14415173516935db1b868c8f7952eef47c0cc57f011853b6a77ec99b56a01c0f4a1b083f123e3dee8ee1312949789b3a410908f2afcaf81a18ea6dc685301d471f91b1d730693329616a4aa460c53825c3e24469571de2b55fe7b9e2ff5031b2d3e2aced2432fa85c4ec2ef0356c23ba81dc589a6aaa470d15555636337014cee7c6c76f5ddf35e1aa0aaf342faf80d4674692b902c8465f60a8f55d6b3c2d3ea5a6bcc24ccf3fb3df7eb0e50c845314d26ef5ed8141b73f79ce64d25d0e647d66c875503c921317892d169fb,
            },
            {
            'message':0x10e3b453719469227b51da0c41b5cf0fd94b32b6b3960b3c2855aff5560433ea2ca627c3c1c281ebeaacd8ee0b05d3262d85e09651f829160487c4b13439294b42baea86585a9ee7fd581e35e761f5221054112e0c48bfc799d0d6b5787e31b57ba56364e063a75fdddf16a97cd01d4da93f2d44898db4980eb74dcac9d93372,
            'expected':0xdd2ea03939bc68d1d40835a099aaa3ee57a4f11e30ad4485089074d345e57363bd6d3c17b86cf35d0629ea91730a0c8ee364ac80a016cfddb6875e1bff463ae284b84959e52046945ee916256582facae719c33c6e892a3a7aaaacdbc300c76486633c8720e6207beb6401f1258997a0bd33c752ea4799ec99685ac1fb9066cae45fc861608cd74aadb367fdebd28fcf88f52ce4942f74c8a53e809fe4953434d6484113501a40605a11c460bd9cf290e37efe33b161b96b63c2270dc1c3669100d1085afd738cf8723cc9f232f679ffee07e1d536a7d56bd2248f37610fa582671d6414440caffd10aa3d09b95fad2c2c41bf0ca33699cf0749110f817a4f63,
            },
            {
            'message':0xd130b2fd9a7a1f118a5d9b6c4bebc0d4d44fdbec8c613766b2779f74fc7d1e7f7e48091cce273f3c66bbb0a249091c9beace1de9491268005f005075bcf58cb36fd739f026a8235f965b40a71de67d95a698bd0dcead1f474520803876c0424d6a864b5fe92650e4e3e453620fa96a2ad256c3426258e5a32b7d38a47205c8b7,
            'expected':0x2b6c07656b398f3b3387627f51aaa51e8f905ef07d7bd82b355396bf32865227f5bf3e0cd3e8e1aa44841e4028e61c58cbe839fb8b7582652c37f7fbf8b51fab980e76635c38aca98b9927dc1e5f17633339d6e903be5bbc65fd7a7a928ddf459bef84a6370c3258dcc810cfe272274d06a1dbed89bf121be3c1699fc129d55d3deca9d7b10de41bd7f47944e26d0e94be9a708b10b3a729ef9ae59ac986de71fe4522284873a19bc177804ecb9acad651055e7dc4f5d29590ebc6d6f965a51dc5b4589699e01ac42aeb579032d5954f160cdea380b0f3c486124bf8ed8884c6861388ff7afaa2fb0b07cc999048135378a16e006d83a98837d259568e89823d,
            },
            {
            'message':0x811fb8028f9c8ce411dcb6ee9f6b9db60928b9ad8da65da14dd3d48600d7b075e73f5ff5025bff7a85e4732b86e2b7e8f8cd708cdcf3c86fb61978303e6526b1597cf26247e74cc31ebb08247779b4af673329a9b1f060f5395287dabc765406bf1c9ad2c5081ac7c5a89b61dbf63d143ea00a8d7266ce3abfc4280ce1d2e27c,
            'expected':0xc33f9dd337fc09da689d1be3055719701581c3c1b41ff7e574db6976ff7b9911c5a4382c9fac346b8dd6ef150f5d194853df3be384acb03b681aab5c8844e31d39658f731417ac942b88b2bba674e01eb151f35add8fd0e65c4738b7150e97c20e577bb320d10f872800df2df55095ac67b2fe4b51805a7c6dab3c288eda94c91699a7f85929a3f98ec92008bf884d7037affe0638a91c540c351e2cd41b3b26f38c4ae7033fab2115f840a6df4c08173c7052499ae817052c068c6c34942d47a0adefd40eedbc7cee3f4898c044f05790334be9423c5231eb5696260ab8f7d6fc6e5b1b86a7e362541e20513294b9d5206440eee2198976584b5840fa68e5a1,
            },
            {
            'message':0xcedfd1c0126a62aea3e7a30a7309c258c69ab7c2f028276760fb88f5dd4a877a10aea67743d62a37687d345e5d992ec56ed568851c4203521c490f0ba3e5f08ee10f06d1cb798d2f1e7ec1ffa159466baa96c880e3c7df814e7835818765ea304aea37f634ba523eced49215c7b3d4f381c51dd8d01f819bfe6f437f12323d08,
            'expected':0x18c454b50814f00da88589f533b87f8ea5195bedbd3e1b2fcce3faca0ab768d71d930a28b29d24044c231c0f24041800e762cd7271c545cdf7f9913f86caa5ea493d1a994902f9ecc1c0daf1c571c2aec78c4ff75e873fef3d6861432f227dd5de635d2315c93e10bbb3cbab1e981ab547b53383143153c0a4a3ce2d7576d89e688327f16636f3ee38f6dbddc0ed42af36b08247d9c91283ee2c52811010fb0a10a3de69b6e42fa11ad44f76f4766b9d6fd0ea179790cd37ee5aa22b62b8010a242ea15c2d0f9cd7564f1645b65cc438093944d60eb0dc42afcd35b16c54c9628070e5eb93826003c84ae66573b84a623a288997bc57a87a3034a392a4e54b80,
            },
            {
            'message':0x7ad20fc0e2886691319e5c41a6e4d438e30b0bcfa95a7ba8e3a20040e6743ac7f791322f0da24083d92a2c7a04b8934cb8618cc4616d8c96b55187f4f2de585c66b763b4350879985775fcf3e05143cc84113f635a005f7de034b2fc40c04cb2d12bea77e121d979b26913d4c217ac634f036cd51b79be036d32c8805883dc72,
            'expected':0x3f48d2f019745b091588182451539c3b1c761016a8d3bf386b3ef046e75c23628be14aeee1db6bb876485a2be2503b39603ed9e07fe35f61cf2051bd8e4ffb281ee960b171efc49f61be17356343aac7d260a1f2b29a77cc81dff36d5d5e75dcb11151501c621e0fa1883ceee2b5befb8b95274f0b3b3f0af0c2282a3527a200346f27c7a6755a5a4f5be9424967e1ed09a312d0d910156dd8df5f6f209ab5bc05b86f02c3d3bd4526bfc0f92e3542399592b5ff47792e3fc8b11e367496d7af6013afff2c433f91f9ae479ec70116e0663d53f8e4de053a0da5c93463271564768a7c0df098d744758630659b84964d61aa940ee0aa3aeda96e8a14dbe0f813,
            },
            ]
        },
    ]
    for tv in testvectors:
        print(tv['n'].bit_length())
        for t in tv['tests']:
            print("message=%x"%t['message'])
            message_bytes=to_bytes(t['message'], byteorder='big')
            sig_bytes = RSA_SIGN_PKCS1_V1_5_SHA256(message_bytes,tv['d'],tv['n'])
            sig = int.from_bytes(sig_bytes,byteorder='little')
            #print("sig=%x"%sig)
            if(sig!=t['expected']):
                print("expected =%x"%t['expected'])
            assert(sig==t['expected'])
            RSA_VERIFY_PKCS1_V1_5_SHA256(message_bytes,sig_bytes,tv['e'],tv['n'])
    print("All test vectors pass")
